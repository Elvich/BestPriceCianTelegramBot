# üè† BestPriceCianTelegramBot

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![PostgreSQL](https://img.shields.io/badge/database-PostgreSQL-blue.svg)](https://www.postgresql.org/)
[![Alembic](https://img.shields.io/badge/migrations-Alembic-red.svg)](https://alembic.sqlalchemy.org/)
[![PyTest](https://img.shields.io/badge/tests-PyTest-green.svg)](https://docs.pytest.org/)

–ú–æ–¥—É–ª—å–Ω–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ "–Ω–∏–∂–µ —Ä—ã–Ω–∫–∞" –Ω–∞ Cian.ru.

---

## üåü –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **ü§ñ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö 24/7 –±–µ–∑ —É—á–∞—Å—Ç–∏—è —á–µ–ª–æ–≤–µ–∫–∞.
- **üîç –ì–ª—É–±–æ–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥**:
  - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± —ç—Ç–∞–∂–∞—Ö, –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ —Ç–æ—á–Ω–æ–º –∞–¥—Ä–µ—Å–µ.
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "—Å–≤–µ–∂–µ—Å—Ç–∏" –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º.
- **üìä –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä**:
  - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
  - –°–∏—Å—Ç–µ–º–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ü–µ–Ω (–≠–∫–æ–Ω–æ–º, –ö–æ–º—Ñ–æ—Ä—Ç, –ë–∏–∑–Ω–µ—Å).
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–µ–∏–≤–∞–Ω–∏–µ –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –∏ —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
- **üì± –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç**:
  - –£–¥–æ–±–Ω—ã–π –≤–∏–¥–µ–æ-–ø–ª–µ–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ –æ–ø–∏—Å–∞–Ω–∏–π.
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ (>100 –∏–ª–∏ >200 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ —Å—É—Ç–∫–∏).
  - –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å "–ª–∞–π–∫–∞–º–∏" –∏ "–¥–∏–∑–ª–∞–π–∫–∞–º–∏".
- **üìÖ –ò—Å—Ç–æ—Ä–∏—è —Ü–µ–Ω**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

```mermaid
graph TD
    Cian[Cian.ru] --> Parser[Parser Service]
    Parser --> StagingDB[(PostgreSQL Staging)]
    StagingDB --> Analyzer[Analyzer Service]
    Analyzer --> ProdDB[(PostgreSQL Production)]
    Analyzer --> Notifications[Telegram Notifications]
    ProdDB --> Bot[Bot Service]
    Bot --> User((User))
```

### –°–µ—Ä–≤–∏—Å—ã:
1.  **Parser Service**: –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–æ–∏—Å–∫–æ–≤—ã–µ –≤—ã–¥–∞—á–∏ –¶–∏–∞–Ω. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç BS4 –∏ LXML. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç "—Å—ã—Ä—ã–µ" –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –±–∞–∑—É.
2.  **Analyzer Service**: –°–∞–º—ã–π "—É–º–Ω—ã–π" –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã, —Å—á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ä–µ—à–∞–µ—Ç, –¥–æ—Å—Ç–æ–π–Ω–∞ –ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤–Ω–∏–º–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
3.  **Bot Service**: Aiogram-–±–æ—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ Production-–±–∞–∑–µ, –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

1.  **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
    ```bash
    cp .env.example .env
    ```
    –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `BOT_TOKEN` –∏ –¥–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–∏—Å–∫ –≤ `CIAN_URLS`.

2.  **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose**:
    ```bash
    docker compose up --build -d
    ```
    *–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.*

---

## üõ† –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- PostgreSQL

1.  **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
    ```bash
    python -m venv .venv
    source .venv/bin/activate
    pip install -r requirements.txt
    ```

2.  **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Alembic)**:
    –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π.
    ```bash
    # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
    alembic upgrade head
    
    # –°–±—Ä–æ—Å –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    python core/database/init_db.py
    ```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –ø–æ–∫—Ä—ã—Ç —é–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.

- **Unit-—Ç–µ—Å—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML –∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –ë–î.
- **Integration-—Ç–µ—Å—Ç—ã**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —ç–º—É–ª—è—Ü–∏—è callback-–∑–∞–ø—Ä–æ—Å–æ–≤.

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/

# –° –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç—á–µ—Ç–∞ –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
pytest --cov=core --cov=services
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
‚îú‚îÄ‚îÄ core/               # –Ø–¥—Ä–æ: –º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ñ–∏–≥, –æ–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ bot/            # –¢–µ–ª–µ–≥—Ä–∞–º-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (aiogram)
‚îÇ   ‚îú‚îÄ‚îÄ parser/         # –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (requests/bs4)
‚îÇ   ‚îî‚îÄ‚îÄ analyzer/       # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ migrations/         # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (Alembic)
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (PyTest)
‚îú‚îÄ‚îÄ scripts/            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã (—ç–∫—Å–ø–æ—Ä—Ç, –º–µ—Ç—Ä–æ)
‚îî‚îÄ‚îÄ docker-compose.yml  # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT
